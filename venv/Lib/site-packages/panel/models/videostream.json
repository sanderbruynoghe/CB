{"code": "\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar p = require(\"core/properties\");\nvar widget_1 = require(\"models/widgets/widget\");\nvar VideoStreamView = /** @class */ (function (_super) {\n    __extends(VideoStreamView, _super);\n    function VideoStreamView() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.constraints = {\n            'audio': false,\n            'video': true\n        };\n        return _this;\n    }\n    VideoStreamView.prototype.initialize = function () {\n        _super.prototype.initialize.call(this);\n        if (this.model.timeout !== null) {\n            this.set_timeout();\n        }\n    };\n    VideoStreamView.prototype.connect_signals = function () {\n        var _this = this;\n        _super.prototype.connect_signals.call(this);\n        this.connect(this.model.properties.snapshot.change, function () { return _this.set_timeout(); });\n        this.connect(this.model.properties.snapshot.change, function () { return _this.snapshot(); });\n        this.connect(this.model.properties.paused.change, function () { return _this.model.paused ? _this.videoEl.pause() : _this.videoEl.play(); });\n    };\n    VideoStreamView.prototype.set_timeout = function () {\n        var _this = this;\n        if (this.timer) {\n            clearInterval(this.timer);\n            this.timer = null;\n        }\n        if (this.model.timeout !== null) {\n            this.timer = setInterval(function () { return _this.snapshot(); }, this.model.timeout);\n        }\n    };\n    VideoStreamView.prototype.snapshot = function () {\n        this.canvasEl.width = this.videoEl.videoWidth;\n        this.canvasEl.height = this.videoEl.videoHeight;\n        var context = this.canvasEl.getContext('2d');\n        if (context)\n            context.drawImage(this.videoEl, 0, 0, this.canvasEl.width, this.canvasEl.height);\n        this.model.value = this.canvasEl.toDataURL(\"image/\" + this.model.format, 0.95);\n    };\n    VideoStreamView.prototype.remove = function () {\n        _super.prototype.remove.call(this);\n        if (this.timer) {\n            clearInterval(this.timer);\n            this.timer = null;\n        }\n    };\n    VideoStreamView.prototype.render = function () {\n        var _this = this;\n        _super.prototype.render.call(this);\n        if (this.videoEl)\n            return;\n        this.videoEl = document.createElement('video');\n        if (!this.model.sizing_mode || this.model.sizing_mode === 'fixed') {\n            if (this.model.height)\n                this.videoEl.height = this.model.height;\n            if (this.model.width)\n                this.videoEl.width = this.model.width;\n        }\n        this.videoEl.style.objectFit = 'fill';\n        this.videoEl.style.minWidth = '100%';\n        this.videoEl.style.minHeight = '100%';\n        this.canvasEl = document.createElement('canvas');\n        this.el.appendChild(this.videoEl);\n        if (navigator.mediaDevices.getUserMedia) {\n            navigator.mediaDevices.getUserMedia(this.constraints)\n                .then(function (stream) {\n                _this.videoEl.srcObject = stream;\n                if (!_this.model.paused) {\n                    _this.videoEl.play();\n                }\n            })\n                .catch(console.error);\n        }\n    };\n    return VideoStreamView;\n}(widget_1.WidgetView));\nexports.VideoStreamView = VideoStreamView;\nvar VideoStream = /** @class */ (function (_super) {\n    __extends(VideoStream, _super);\n    function VideoStream(attrs) {\n        return _super.call(this, attrs) || this;\n    }\n    VideoStream.initClass = function () {\n        this.prototype.type = \"VideoStream\";\n        this.prototype.default_view = VideoStreamView;\n        this.define({\n            format: [p.String, 'png'],\n            paused: [p.Boolean, false],\n            snapshot: [p.Boolean, false],\n            timeout: [p.Number, null],\n            value: [p.Any,]\n        });\n        this.override({\n            height: 240,\n            width: 320\n        });\n    };\n    return VideoStream;\n}(widget_1.Widget));\nexports.VideoStream = VideoStream;\nVideoStream.initClass();\n", "deps": ["core/properties", "models/widgets/widget"], "hash": "ead8c57259ffabe135a672390b435eb1f5571911eb5592aeecc1261de75e6ad8"}